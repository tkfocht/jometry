<html>
    <head>
        <title>J!ometry: Daily Jeopardy Visualizations</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">
        <link rel="stylesheet" href="css/site.css"></link>
        <link rel="stylesheet" href="css/game.css"></link>
        <script src="/js/d3/d3.v7.min.js"></script>
        <script src="/js/util/util.v1.js"></script>
        <script src="/js/graphs/full_game_scatter.v1.js"></script>
        <script src="/js/graphs/by_round_scatter.v1.js"></script>
        <script src="/js/util/shared_graph_productiion.v1.js"></script>
    </head>
    <body>
        <h1><a href="index.html">J!ometry</a></h1>
        <div>
            <a href="/index.html">Home</a>&nbsp;<a href="/glossary.html">Glossary</a>
        </div>
        <div class="section">
            <h1><span id="season-id"></span> Game <span id="game-number"></span> Summary <span id="game-date"></span></h1>
            <div id="game-summary">
                <table>
                    <thead>
                        <tr>
                            <th colspan="1" class="empty"></th>
                            <th colspan="7">Jeopardy! Round, GCon <span id="j-gcon"></span></th>
                            <th colspan="7">Double Jeopardy! Round, GCon <span id="dj-gcon"></span></th>
                            <th colspan="3" class="empty"></th>
                        </tr>
                        <tr>
                            <th>Contestant</th>
                            <th>Att</th>
                            <th>BuzC</th>
                            <th>Speed</th>
                            <th>Solo</th>
                            <th>Buz$</th>
                            <th>DD</th>
                            <th>DD+</th>
                            <th>Att</th>
                            <th>BuzC</th>
                            <th>Speed</th>
                            <th>Solo</th>
                            <th>Buz$</th>
                            <th>DD</th>
                            <th>DD+</th>
                            <th>Total Buz$</th>
                            <th>DJ! Final Score</th>
                            <th>FJ! Final Score</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="graph-description">
                GCon = Game contention, Att = Attempts, BuzC = Correct on buzz,
                Speed = Est. buzzes created through speed, Solo = Estimated buzzes uncontested,
                Bz$ = Score on buzz, DD = Daily Doubles found, DD+ = Daily Doubles found above expectation
            </div>
            <div id="scatter-gcon"></div>
        </div>
        <div class="section">
            <h1>Attempt Distribution</h1>
            <div class="graph-description">
                All buzz attempts, by contestant and round. Correct responses are at the bottom, incorrect responses are lighter and
                in the middle, and attempts where the contestant was locked out are lightest and at the top.
            </div>
            <div id="bar-attempts"></div>
        </div>
        <div class="section">
            <h1>Speed and Solo</h1>
            <div class="graph-description">
                Speed is an estimate of additional buzzes a contestant creates through speed (or opponents' lack of speed). A
                higher Speed represents winning a higher number of buzzer races. Solo is an estimate of how many
                of a contestant's correct responses did not have an opponent ringing in with a possibly-correct response.
                Higher Solo represents a contestant that is the only player ringing in more often. Other games by the same
                contestants are in the same color, but faded.
            </div>
            <div id="scatter-speed-solo-game"></div>
        </div>
        <div class="section">
            <h1>Speed and Solo by Round</h1>
            <div class="graph-description">
                Speed is an estimate of additional buzzes a contestant creates through speed (or opponents' lack of speed). A
                higher Speed represents winning a higher number of buzzer races. Solo is an estimate of how many
                of a contestant's correct responses did not have an opponent ringing in with a possibly-correct response.
                Higher Solo represents a contestant that is the only player ringing in more often. Jeopardy! round
                is circles, connected to Double Jeopardy! round as squares. This game's contestants
                are labeled. Other games by the same
                contestants are in the same color, but faded.
            </div>
            <div id="scatter-speed-solo-combined"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz%</h1>
            <div class="graph-description">
                Number of attempts to buzz and percent of successful buzzes, over the whole game. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-buzz-pct"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz% by Round</h1>
            <div class="graph-description">
                Number of attempts to buzz and percent of successful buzzes, over the whole game. Jeopardy! round
                is circles, connected to Double Jeopardy! round as squares. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-buzz-pct-by-round"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz$/Att</h1>
            <div class="graph-description">
                Number of attempts to buzz and money earned on buzzes per attempt, over the whole game. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-score-att"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz$/Att by Round</h1>
            <div class="graph-description">
                Number of attempts to buzz and money earned on buzzes per attempt, over the whole game. Jeopardy! round
                is circles, connected to Double Jeopardy! round as squares. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-score-att-by-round"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz$/Buz</h1>
            <div class="graph-description">
                Number of attempts to buzz and money earned per buzz, over the whole game. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-score-buzz"></div>
        </div>
        <div class="section">
            <h1>Att vs Buz$/Buz by Round</h1>
            <div class="graph-description">
                Number of attempts to buzz and money earned per buzz, over the whole game. Jeopardy! round
                is circles, connected to Double Jeopardy! round as squares. This game's
                contestant performances are labeled. Other games by the same contestants are in the same color, but faded.
            </div>
            <div id="scatter-att-score-buzz-by-round"></div>
        </div>
        <div id="footer">
            <p>This site is not affiliated with Jeopardy!. Data is taken from their published <a href="https://www.jeopardy.com/jbuzz/news-events/jeopardy-daily-box-scores">box scores.</a></p>
        </div>
        <script type="text/javascript">
            var seasonId = new URLSearchParams(window.location.search).get('season');
            var highlightGame = new URLSearchParams(window.location.search).get('game_id');
            d3.select("#season-id")
                .data([seasonId])
                .text(d => d);
            d3.select("#game-number")
                .data([highlightGame])
                .text(d => d);
            d3.csv(csvUrlForSeason(seasonId)).then(function(data) {
                var margin = {top: 20, right: 20, bottom: 50, left: 70},
                    width = 960 - margin.left - margin.right,
                    height = 500 - margin.top - margin.bottom;

                //Data transformations
                data.forEach(function(d) {
                    d['Date'] = csvDateParse(d['Date']);
                    d['J! Buzz %'] = 100.0 * d['J! Buzzes'] / d['J! Attempts'];
                    d['J! GCon %'] = 100.0 * d['J! Game Contention'];
                    d['DJ! Buzz %'] = 100.0 * d['DJ! Buzzes'] / d['DJ! Attempts'];
                    d['DJ! GCon %'] = 100.0 * d['DJ! Game Contention'];
                    d['Total Buzz %'] = 100.0 * d['Total Buzz'] / d['Total Attempt'];
                    d['highlightGame'] = d['Game Id'] == highlightGame;
                });
                var highlightGameData = d3.filter(data, d => d['highlightGame']);
                d3.select("#game-date")
                    .data([highlightGameData[0]])
                    .text(d => dateFormat(d['Date']));
                var highlightGameContestants = d3.map(highlightGameData, d => d['Contestant']);
                data.forEach(function(d) {
                    d['highlightContestant'] = highlightGameContestants.includes(d['Contestant']);
                });

                //Graphics functions
                var color = d3.scaleOrdinal()
                    .domain(highlightGameContestants)
                    .range(['#0072B2','#E69F00','#009E73'])
                var highlightGameColorFunction = function(d) {
                    if (d['highlightGame'] || d['highlightContestant']) {
                        return color(d['Contestant']);
                    } else {
                        return "black";
                    }
                };
                var highlightGameOpacityFunction = function(d) {
                    if (d['highlightGame']) {
                        return 1.0;
                    } else if (d['highlightContestant']) {
                        return 0.5;
                    } else {
                        return 0.1;
                    }
                };
                var highlightGameLabelFunction = function(d) {
                    if (d['highlightGame']) {
                        return d['Contestant'];
                    }
                };

                //Summary table
                var summaryTr = d3.select("#game-summary table tbody")
                    .selectAll("tr")
                    .data(highlightGameData)
                    .enter()
                    .append("tr");
                d3.select("#game-summary span#j-gcon")
                    .text((100 * highlightGameData[0]['J! Game Contention']).toFixed(0) + "%");
                d3.select("#game-summary span#dj-gcon")
                    .text((100 * highlightGameData[0]['DJ! Game Contention']).toFixed(0) + "%");
                summaryTr.selectAll("td")
                    .data(function(d,i) {
                        return [
                            d['Contestant'],
                            d['J! Attempts'],
                            d['J! Correct on Buzz'],
                            (+d['J! Expected Buzz Difference'] > 0 ? "+" : "" ) + (+d['J! Expected Buzz Difference']).toFixed(1),
                            (+d['J! Exp Uncontested']).toFixed(1),
                            d['J! Score on Buzz'],
                            d['J! DDs found'],
                            (+d['J! DD Exp Diff'] > 0 ? "+" : "" ) + (+d['J! DD Exp Diff']).toFixed(2),
                            d['DJ! Attempts'],
                            d['DJ! Correct on Buzz'],
                            (+d['DJ! Expected Buzz Difference'] > 0 ? "+" : "" ) + (+d['DJ! Expected Buzz Difference']).toFixed(1),
                            (+d['DJ! Exp Uncontested']).toFixed(1),
                            d['DJ! Score on Buzz'],
                            d['DJ! DDs found'],
                            (+d['DJ! DD Exp Diff'] > 0 ? "+" : "" ) + (+d['DJ! DD Exp Diff']).toFixed(2),
                            d['Total Score on Buzz'],
                            d['DJ! End Score'],
                            d['FJ! End Score']
                        ];
                    })
                    .enter()
                    .append("td")
                    .html(function(d,i) {
                        if (i>0) return d;
                        return '<span style="color: ' + color(d) + '">&#9632;</span>&nbsp;<a href="contestant.html?season=' + seasonId + '&contestant=' + d + '">' + d + "</a>";
                    });

                var gConData = d3.filter(data, d => +d['Podium'] === 1);
                var gConMin = d3.min(d3.map(gConData, d => d3.min([d['J! GCon %'], d['DJ! GCon %']])));
                gConMin = 10 * Math.floor(gConMin / 10.0);
                var gConMax = d3.max(d3.map(gConData, d => d3.max([d['J! GCon %'], d['DJ! GCon %']])));
                gConMax = 10 * Math.ceil(gConMax / 10.0);
                var gconScatter = fullGameScatter(
                    '#scatter-gcon',
                    gConData,
                    'J! GCon %', [gConMin, gConMax], 'J! GCon %',
                    'DJ! GCon %', [gConMin, gConMax], 'DJ! GCon %',
                    d => "black", d => d['highlightGame'] ? 1.0 : 0.1, d => "",
                    200, 200, margin
                );

                renderSharedGraphs(data,
                    highlightGameColorFunction, highlightGameOpacityFunction, highlightGameLabelFunction,
                    [], [],
                    width, height, margin);

                //Attempt Distribution
                svg = d3.select("#bar-attempts").append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                            .append("g")
                            .attr("transform",
                                "translate(" + margin.left + "," + margin.top + ")");
                var x = d3.scaleBand()
                    .domain(['J!', 'DJ!'])
                    .range([0, width])
                    .padding([0.2]);
                var y = d3.scaleLinear().range([height, 0]);
                y.domain([0, 30]);
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).tickSize(0));
                svg.append("g")
                    .call(d3.axisLeft(y));
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x",0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text("Attempts");  

                var xSubgroup = d3.scaleBand()
                    .domain(highlightGameContestants)
                    .range([0, x.bandwidth()])
                    .padding([0.05]);

                var jG = svg.append('g')
                    .attr("transform", function(d) { return "translate(" + x('J!') + ",0)"; });
                var jGCorrectG = jG.append('g');
                var jGIncorrectG = jG.append('g');
                var jGLockedG = jG.append('g');
                jGCorrectG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['J! Correct on Buzz']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['J! Correct on Buzz']); })
                    .attr("fill", highlightGameColorFunction);
                jGIncorrectG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['J! Buzzes']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['J! Buzzes'] - d['J! Correct on Buzz']); })
                    .attr("fill", highlightGameColorFunction)
                    .attr("opacity", 0.7);
                jGLockedG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['J! Attempts']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['J! Attempts'] - d['J! Buzzes']); })
                    .attr("fill", highlightGameColorFunction)
                    .attr("opacity", 0.3);

                var djG = svg.append('g')
                    .attr("transform", function(d) { return "translate(" + x('DJ!') + ",0)"; });
                var djGCorrectG = djG.append('g');
                var djGIncorrectG = djG.append('g');
                var djGLockedG = djG.append('g');
                djGCorrectG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['DJ! Correct on Buzz']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['DJ! Correct on Buzz']); })
                    .attr("fill", highlightGameColorFunction);
                djGIncorrectG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['DJ! Buzzes']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['DJ! Buzzes'] - d['DJ! Correct on Buzz']); })
                    .attr("fill", highlightGameColorFunction)
                    .attr("opacity", 0.7);
                djGLockedG.selectAll('rect')
                    .data(highlightGameData)
                    .enter()
                    .append('rect')
                    .attr('x', function(d) { return xSubgroup(d['Contestant']); })
                    .attr('y', function(d) { return y(d['DJ! Attempts']); })
                    .attr("width", xSubgroup.bandwidth())
                    .attr("height", function(d) { return height - y(d['DJ! Attempts'] - d['DJ! Buzzes']); })
                    .attr("fill", highlightGameColorFunction)
                    .attr("opacity", 0.3);

                var legend = svg.append("g")
                    .attr("font-size", 13)
                    .attr("text-anchor", "start")
                    .selectAll("g")
                    .data(highlightGameContestants)
                    .enter().append("g")
                    .attr("transform", function(d, i) { return "translate(0," + i * 24 + ")"; });
                legend.append("rect")
                    .attr("x", width - 142)
                    .attr("width", 8)
                    .attr("height", 8)
                    .attr("fill", color);
                legend.append("text")
                        .attr("x", width - 132)
                        .attr("y", 5.5)
                        .attr("dy", "0.22em")
                        .text(d => (d));

            });
        </script>
    </body>
</html>