<html>
    <head>
        <title>J!ometry: Daily Jeopardy Visualizations</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto">
        <link rel="stylesheet" href="css/site.css"></link>
        <link rel="stylesheet" href="css/season.css"></link>
        <script src="https://cdn.plot.ly/plotly-2.12.1.min.js"></script>
        <script src="/js/d3/d3.v7.min.js"></script>
        <script src="/js/util/util.v3.js"></script>
        <script src="/js/graphs/period_box_plot.v2.js"></script>
        <script src="/js/graphs/full_game_scatter.v3.js"></script>
        <script src="/js/graphs/by_round_scatter.v1.js"></script>
        <script src="/js/util/shared_graph_production.v4.js"></script>
    </head>
    <body>
        <div id="header">
            <div id="site-mast">J!ometry</div>
            <div id="navigation">
                <span class="navigation-item"><a href="/">Home</a></span>
                <span class="navigation-item"><a href="/glossary.html">Glossary</a></span>
            </div>
        </div>

        <div class="section">
            <h1><span id="toc-period-id"></span> Qualification Period Summary</h1>
            <div class="graph-description">
                "Average" is the average of all contestant performances, not just those shown individually. Each game performace
                is a separate data point, so champions are included separately in the average for each of their games.
            </div>
            <div id="season-contestant-summary" class="season-contestant-summary">
                <table class="controlled-table" id="contestant-summary-table">
                    <thead>
                        <tr>
                            <th colspan="1" class="empty"></th>
                            <th colspan="15" class="cumulative controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">Totals</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="16" class="game-average controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">Game Averages</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="12" class="j-average controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">J! Averages</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="12" class="dj-average controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">DJ! Averages</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="16" class="game-maximum controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">Game Maximums</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="12" class="j-maximum controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">J! Maximums</div><div class="table-control table-control-right">&#9654;</div></div></th>
                            <th colspan="12" class="dj-maximum controlled"><div class="control-container"><div class="table-control table-control-left">&#9664;</div><div class="label">DJ! Maximums</div><div class="table-control table-control-right">&#9654;</div></div></th>
                        </tr>
                        <tr>
                            <th>Contestant</th>
                            <th class="controlled cumulative">W</th>
                            <th class="controlled cumulative">Ld</th>
                            <th class="controlled cumulative">Cr</th>
                            <th class="controlled cumulative">Lk</th>
                            <th class="controlled cumulative">Win$</th>
                            <th class="controlled cumulative">Att</th>
                            <th class="controlled cumulative">Buz</th>
                            <th class="controlled cumulative">Buz%</th>
                            <th class="controlled cumulative">Buz$</th>
                            <th class="controlled cumulative">DDF</th>
                            <th class="controlled cumulative">DD+</th>
                            <th class="controlled cumulative">DD$</th>
                            <th class="controlled cumulative">FJ</th>
                            <th class="controlled cumulative">FJ$</th>
                            <th class="controlled cumulative">FJFinal$</th>
                            <th class="controlled game-average">Att</th>
                            <th class="controlled game-average">Buz</th>
                            <th class="controlled game-average">Buz$</th>
                            <th class="controlled game-average">Buz$/</th>
                            <th class="controlled game-average">Buz%</th>
                            <th class="controlled game-average">BuzC</th>
                            <th class="controlled game-average">BuzC$</th>
                            <th class="controlled game-average">Spd</th>
                            <th class="controlled game-average">Sol</th>
                            <th class="controlled game-average">DDF</th>
                            <th class="controlled game-average">DD+</th>
                            <th class="controlled game-average">DD$</th>
                            <th class="controlled game-average">JFinal$</th>
                            <th class="controlled game-average">DJFinal$</th>
                            <th class="controlled game-average">FJ$</th>
                            <th class="controlled game-average">FJFinal$</th>
                            <th class="controlled j-average">Att</th>
                            <th class="controlled j-average">Buz</th>
                            <th class="controlled j-average">Buz$</th>
                            <th class="controlled j-average">Buz$/</th>
                            <th class="controlled j-average">Buz%</th>
                            <th class="controlled j-average">BuzC</th>
                            <th class="controlled j-average">BuzC$</th>
                            <th class="controlled j-average">Spd</th>
                            <th class="controlled j-average">Sol</th>
                            <th class="controlled j-average">DDF</th>
                            <th class="controlled j-average">DD+</th>
                            <th class="controlled j-average">DD$</th>
                            <th class="controlled dj-average">Att</th>
                            <th class="controlled dj-average">Buz</th>
                            <th class="controlled dj-average">Buz$</th>
                            <th class="controlled dj-average">Buz$/</th>
                            <th class="controlled dj-average">Buz%</th>
                            <th class="controlled dj-average">BuzC</th>
                            <th class="controlled dj-average">BuzC$</th>
                            <th class="controlled dj-average">Spd</th>
                            <th class="controlled dj-average">Sol</th>
                            <th class="controlled dj-average">DDF</th>
                            <th class="controlled dj-average">DD+</th>
                            <th class="controlled dj-average">DD$</th>
                            <th class="controlled game-maximum">Att</th>
                            <th class="controlled game-maximum">Buz</th>
                            <th class="controlled game-maximum">Buz$</th>
                            <th class="controlled game-maximum">Buz$/</th>
                            <th class="controlled game-maximum">Buz%</th>
                            <th class="controlled game-maximum">BuzC</th>
                            <th class="controlled game-maximum">BuzC$</th>
                            <th class="controlled game-maximum">Spd</th>
                            <th class="controlled game-maximum">Sol</th>
                            <th class="controlled game-maximum">DDF</th>
                            <th class="controlled game-maximum">DD+</th>
                            <th class="controlled game-maximum">DD$</th>
                            <th class="controlled game-maximum">JFinal$</th>
                            <th class="controlled game-maximum">DJFinal$</th>
                            <th class="controlled game-maximum">FJ$</th>
                            <th class="controlled game-maximum">FJFinal$</th>
                            <th class="controlled j-maximum">Att</th>
                            <th class="controlled j-maximum">Buz</th>
                            <th class="controlled j-maximum">Buz$</th>
                            <th class="controlled j-maximum">Buz$/</th>
                            <th class="controlled j-maximum">Buz%</th>
                            <th class="controlled j-maximum">BuzC</th>
                            <th class="controlled j-maximum">BuzC$</th>
                            <th class="controlled j-maximum">Spd</th>
                            <th class="controlled j-maximum">Sol</th>
                            <th class="controlled j-maximum">DDF</th>
                            <th class="controlled j-maximum">DD+</th>
                            <th class="controlled j-maximum">DD$</th>
                            <th class="controlled dj-maximum">Att</th>
                            <th class="controlled dj-maximum">Buz</th>
                            <th class="controlled dj-maximum">Buz$</th>
                            <th class="controlled dj-maximum">Buz$/</th>
                            <th class="controlled dj-maximum">Buz%</th>
                            <th class="controlled dj-maximum">BuzC</th>
                            <th class="controlled dj-maximum">BuzC$</th>
                            <th class="controlled dj-maximum">Spd</th>
                            <th class="controlled dj-maximum">Sol</th>
                            <th class="controlled dj-maximum">DDF</th>
                            <th class="controlled dj-maximum">DD+</th>
                            <th class="controlled dj-maximum">DD$</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="graph-description">
                W = Wins, Ld = Leads (at end of DJ), Cr = Crushes, Lk = Locks, Win$ = Winnings, Att = Attempts,
                Buz = Buzzes, BuzC = Correct on buzz, BuzI = Incorrect on buzz,
                Spd = Speed = Est. buzzes created through speed, Sol = Solo = Estimated buzzes uncontested,
                Buz$ = Score on buzz, DDF = Daily Doubles found, DD+ = Daily Doubles found above expectation,
                FJ$ = Net score in FJ
            </div>
        </div>
        <div class="section">
            <h1>Buzz Distribution</h1>
            <div class="graph-description">
                Average buzzes, by contestant. Correct responses are at the bottom, incorrect responses are lighter and
                on top.
            </div>
            <div id="bar-buzzes" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div class="graph-description">
                Average score on buzzes, by contestant. Score is shown full color. Score lost on incorrect buzz responses is shown lighter on top.
                Score on correct buzz responses is the sum of the two.
            </div>
            <div id="bar-buz$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buzc-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buzi-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Buzzes</h1>
            <div class="graph-description">
                Buzzes, by contestant, in each game.
            </div>
            <div id="box-buz" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buz-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Attempts</h1>
            <div class="graph-description">
                Attempts, by contestant, in each game.
            </div>
            <div id="box-att" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-att-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Buz%</h1>
            <div class="graph-description">
                Buzzes/Attempts, by contestant, in each game.
            </div>
            <div id="box-buz%" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buz%-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Buz$</h1>
            <div class="graph-description">
                Money earned/lost on buzzes, by contestant, in each game.
            </div>
            <div id="box-buz$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buz$-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Buz$/Buz</h1>
            <div class="graph-description">
                Money earned/lost on buzzes on the average buzz, by contestant, in each game.
            </div>
            <div id="box-buz$-per-buz" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-buz$-per-buz-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Speed</h1>
            <div class="graph-description">
                Estimated buzzes earned by speed, by contestant, in each game.
            </div>
            <div id="box-speed" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-speed-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Solo</h1>
            <div class="graph-description">
                Estimated buzzes where only contestant attempting, by contestant, in each game.
            </div>
            <div id="box-solo" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-solo-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Speed plus Solo</h1>
            <div class="graph-description">
                Speed plus Solo, by contestant, in each game. Each value varies widely based on the competition, but the sum is meaningful.
            </div>
            <div id="box-speed-plus-solo" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-speed-plus-solo-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>DD+</h1>
            <div class="graph-description">
                Daily Doubles found above expected number, by contestant, in each game.
            </div>
            <div id="box-dd+" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-dd+-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>DD$</h1>
            <div class="graph-description">
                Money earned/lost on Daily Doubles, by contestant, in each game.
            </div>
            <div id="box-dd$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
            <div id="line-dd$-j-dj" style="width:600px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>DJFinal$</h1>
            <div class="graph-description">
                Score after Double Jeopardy, by contestant, in each game.
            </div>
            <div id="box-djfinal$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>FJ$</h1>
            <div class="graph-description">
                Money earned/lost on Final Jeopardy, by contestant, in each game.
            </div>
            <div id="box-fj$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>FJFinal$</h1>
            <div class="graph-description">
                Final score after Final Jeopardy, by contestant, in each game.
            </div>
            <div id="box-fjfinal$" style="width:1000px;height:500px;margin-bottom:1em;"></div>
        </div>
        <div class="section">
            <h1>Buz$/Buz vs Buz plot</h1>
            <div class="graph-description">
                Buz$/Buz vs Buz, per game. 4+ game champions are marked larger.
            </div>
            <div id="scatter-buz$-buz-vs-buz" style="width:1000px;height:500px;"></div>
        </div>
        <div class="section">
            <h1>Avg Buz$/Buz vs Buz plot</h1>
            <div class="graph-description">
                Average Buz$/Buz vs Buz, per contestant.
            </div>
            <div id="scatter-avg-buz$-buz-vs-buz" style="width:1000px;height:500px;"></div>
        </div>
        <div id="footer">
            <p>This site is not affiliated with Jeopardy!. Data is taken from their published <a href="https://www.jeopardy.com/jbuzz/news-events/jeopardy-daily-box-scores">box scores.</a></p>
        </div>
        <script type="text/javascript">
            var tocPeriodId = new URLSearchParams(window.location.search).get('toc_period');
            var tocPeriodAverageLabel = tocPeriodId + " Average";
            d3.select("#toc-period-id")
                .data([tocPeriodId])
                .text(d => d);
            d3.csv(csvUrlForTocPeriod(tocPeriodId)).then(function(data) {
                //Data transformations
                data.forEach(function(d) {
                    d['Date'] = csvDateParse(d['Date']);
                    d['BuzC'] = +d['JBuzC'] + +d['DJBuzC'];
                    d['BuzC$'] = +d['JBuzC$'] + +d['DJBuzC$'];
                    d['BuzI'] = +d['JBuzInc'] + +d['DJBuzInc'];
                    d['BuzI$'] = +d['JBuzI$'] + +d['DJBuzI$'];
                    d['JBuz%'] = 100.0 * d['JBuz'] / d['JAtt'];
                    d['DJBuz%'] = 100.0 * d['DJBuz'] / d['DJAtt'];
                    d['Buz%'] = 100.0 * d['Buz'] / d['Att'];
                    d['FJ$'] = d['FJCor'] === "" ? 0 : (2 * +d['FJCor'] - 1) * +d['FJWager'];
                });

                var highlightContestantIds = new URLSearchParams(window.location.search).get('contestants');
                var highlightContestantCounts = d3.rollup(data, v => d3.sum(d3.map(v, cd => (+cd['Wins']))), d => d['Jometry Contestant Id']);
                var contestantWinnings = d3.rollup(data, v => d3.sum(d3.map(v, cd => (+cd['Wins'] * +cd['FJFinal$']))), d => d['Jometry Contestant Id']);
                var contestantScores = d3.rollup(data, v => d3.sum(d3.map(v, cd => +cd['FJFinal$'])), d => d['Jometry Contestant Id']);
                if (highlightContestantIds === null) {
                    var gameThreshold = 4;
                    highlightContestantIds = d3.filter(highlightContestantCounts.keys(), k => highlightContestantCounts.get(k) >= gameThreshold);
                    while (highlightContestantIds.length < 5) {
                        gameThreshold--;
                        highlightContestantIds = d3.filter(highlightContestantCounts.keys(), k => highlightContestantCounts.get(k) >= gameThreshold);
                    }
                    highlightContestantIds.sort(function(a,b) {
                        var winsDiff = highlightContestantCounts.get(b) - highlightContestantCounts.get(a);
                        if (winsDiff !== 0) {
                            return winsDiff;
                        }
                        var winningsDiff = contestantWinnings.get(b) - contestantWinnings.get(a);
                        if (winningsDiff !== 0) {
                            return winningsDiff;
                        }
                        return contestantScores.get(b) - contestantScores.get(a);
                    });
                } else {
                    highlightContestantIds = highlightContestantIds.split(',');
                }

                /*var latestDate = d3.max(d3.map(data, d => d['Date']));
                var currentChampionToHighlight = d3.map(d3.filter(data, d => d['Date'] >= latestDate && +d['Wins'] > 0), d => d['Jometry Contestant Id']);
                if ((new Date().getTime() - latestDate.getTime()) / (1000 * 3600 * 24) <= 5) {
                    highlightContestantIds = highlightContestantIds.concat(Array.from(d3.difference(currentChampionToHighlight, highlightContestantIds)));
                }*/

                data.forEach(function(d) {
                    d['highlightContestant'] = highlightContestantIds.includes(d['Jometry Contestant Id']);
                });
                var groupedData = d3.group(data, cd => cd['Jometry Contestant Id']);

                //Graphics functions
                var color = d3.scaleOrdinal()
                    .domain(highlightContestantIds)
                    .range(d3.schemeCategory10.concat(d3.schemeDark2));
                var colorFunction = function(d) {
                    if (d['highlightContestant']) {
                        return color(d['Jometry Contestant Id']);
                    } else {
                        return "black";
                    }
                };
                var opacityFunction = function(d) {
                    if (d['highlightContestant']) {
                        return 1;
                    } else {
                        return 0.1;
                    }
                };
                var labelFunction = function(d) {
                    return "";
                };


                var summaryTr = d3.select("#season-contestant-summary table tbody")
                    .selectAll("tr")
                    .data(highlightContestantIds.concat([-1]))
                    .enter()
                    .append("tr");
                summaryTr.selectAll("td")
                    .data(function(cid,i) {
                        var contestantData = data;
                        if (cid > 0) {
                            contestantData = groupedData.get(cid);
                        }
                        var contestantDataWithBoxScore = d3.filter(contestantData, d => d['Att'] !== '');
                        return [
                            cid >= 0 ? '<span style="color: ' + colorFunction(contestantData[0]) + '">&#9632;</span>&nbsp;<a href="contestant.html?toc_period_id=' + tocPeriodId + '&contestant=' + cid + '">' + getContestantNameFromData(contestantData, cid) + "</a>" : 'All Contestants',
                            d3.sum(contestantData, d => +d['Wins']),
                            d3.sum(contestantData, d => +d['Leads']),
                            d3.sum(contestantData, d => +d['Crushes']),
                            d3.sum(contestantData, d => +d['Locks']),
                            d3.sum(contestantData, d => +d['FJFinal$'] * +d['Wins']),
                            contestantDataWithBoxScore.length > 0 ? d3.sum(contestantDataWithBoxScore, d => d['Att']).toFixed(0) : '',
                            d3.sum(contestantData, d => +d['Buz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? (100 * d3.sum(contestantDataWithBoxScore, d => +d['Buz']) / d3.sum(contestantDataWithBoxScore, d => +d['Att'])).toFixed(1) : '',
                            d3.sum(contestantData, d => +d['Buz$']).toFixed(0),
                            d3.sum(contestantData, d => +d['JDDF'] + +d['DJDDF']).toFixed(0),
                            d3.sum(contestantData, d => +d['JDD+'] + +d['DJDD+']).toFixed(2),
                            d3.sum(contestantData, d => +d['JDD'] + +d['DJDD1'] + +d['DJDD2']).toFixed(0),
                            d3.sum(contestantData, d => +d['FJCor']) + '/' + d3.sum(contestantData, d => +d['DJFinal$'] > 0 ? 1 : 0),
                            d3.sum(contestantData, d => +d['FJ$']).toFixed(0),
                            d3.sum(contestantData, d => +d['FJFinal$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['Att']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['Buz']).toFixed(1),
                            d3.mean(contestantData, d => +d['Buz$']).toFixed(0),
                            d3.mean(contestantData, d => +d['Buz'] === 0 ? 0 : d['Buz$'] / d['Buz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['Att'] === 0 ? 0 : 100.0 * +d['Buz'] / +d['Att']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['BuzC']).toFixed(1),
                            d3.mean(contestantData, d => +d['BuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['Speed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['Solo']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['JDDF'] + +d['DJDDF']).toFixed(1),
                            d3.mean(contestantData, d => +d['JDD+'] + +d['DJDD+']).toFixed(2),
                            d3.mean(contestantData, d => +d['JDD'] + +d['DJDD1'] + +d['DJDD2']).toFixed(0),
                            d3.mean(contestantData, d => +d['JFinal$']).toFixed(0),
                            d3.mean(contestantData, d => +d['DJFinal$']).toFixed(0),
                            d3.mean(contestantData, d => +d['FJ$']).toFixed(0),
                            d3.mean(contestantData, d => +d['FJFinal$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['JAtt']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['JBuz']).toFixed(1),
                            d3.mean(contestantData, d => +d['JBuz$']).toFixed(0),
                            d3.mean(contestantData, d => +d['JBuz'] === 0 ? 0 : +d['JBuz$'] / +d['JBuz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['JAtt'] === 0 ? 0 : 100.0 * +d['JBuz'] / +d['JAtt']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['JBuzC']).toFixed(1),
                            d3.mean(contestantData, d => +d['JBuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['JSpeed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['JSolo']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['JDDF']).toFixed(1),
                            d3.mean(contestantData, d => +d['JDD+']).toFixed(2),
                            d3.mean(contestantData, d => +d['JDD']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['DJAtt']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['DJBuz']).toFixed(1),
                            d3.mean(contestantData, d => +d['DJBuz$']).toFixed(0),
                            d3.mean(contestantData, d => +d['DJBuz'] === 0 ? 0 : d['DJBuz$'] / d['DJBuz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['DJAtt'] === 0 ? 0 : 100.0 * +d['DJBuz'] / +d['DJAtt']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['DJBuzC']).toFixed(1),
                            d3.mean(contestantData, d => +d['DJBuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['DJSpeed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.mean(contestantDataWithBoxScore, d => +d['DJSolo']).toFixed(1) : '',
                            d3.mean(contestantData, d => +d['DJDDF']).toFixed(1),
                            d3.mean(contestantData, d => +d['DJDD+']).toFixed(2),
                            d3.mean(contestantData, d => +d['DJDD1'] + +d['DJDD2']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['Att']).toFixed(0) : '',
                            d3.max(contestantData, d => +d['Buz']).toFixed(0),
                            d3.max(contestantData, d => +d['Buz$']).toFixed(0),
                            d3.max(contestantData, d => +d['Buz'] === 0 ? 0 : +d['Buz$'] / +d['Buz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['Att'] === 0 ? 0 : 100.0 * +d['Buz'] / +d['Att']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['BuzC']).toFixed(0),
                            d3.max(contestantData, d => +d['BuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['Speed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['Solo']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['JDDF'] + +d['DJDDF']).toFixed(0),
                            d3.max(contestantData, d => +d['JDD+'] + +d['DJDD+']).toFixed(2),
                            d3.max(contestantData, d => +d['JDD'] + +d['DJDD1'] + +d['DJDD2']).toFixed(0),
                            d3.max(contestantData, d => +d['JFinal$']).toFixed(0),
                            d3.max(contestantData, d => +d['DJFinal$']).toFixed(0),
                            d3.max(contestantData, d => +d['FJ$']).toFixed(0),
                            d3.max(contestantData, d => +d['FJFinal$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['JAtt']).toFixed(0) : '',
                            d3.max(contestantData, d => +d['JBuz']).toFixed(0),
                            d3.max(contestantData, d => +d['JBuz$']).toFixed(0),
                            d3.max(contestantData, d => +d['JBuz'] === 0 ? 0 : d['JBuz$'] / d['JBuz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['JAtt'] === 0 ? 0 : 100.0 * +d['JBuz'] / +d['JAtt']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['JBuzC']).toFixed(0),
                            d3.max(contestantData, d => +d['JBuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['JSpeed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['JSolo']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['JDDF']).toFixed(0),
                            d3.max(contestantData, d => +d['JDD+']).toFixed(2),
                            d3.max(contestantData, d => +d['JDD']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['DJAtt']).toFixed(0) : '',
                            d3.max(contestantData, d => +d['DJBuz']).toFixed(0),
                            d3.max(contestantData, d => +d['DJBuz$']).toFixed(0),
                            d3.max(contestantData, d => +d['DJBuz'] === 0 ? 0 : d['DJBuz$'] / d['DJBuz']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['DJAtt'] === 0 ? 0 : 100.0 * +d['DJBuz'] / +d['DJAtt']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['DJBuzC']).toFixed(0),
                            d3.max(contestantData, d => +d['DJBuzC$']).toFixed(0),
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['DJSpeed']).toFixed(1) : '',
                            contestantDataWithBoxScore.length > 0 ? d3.max(contestantDataWithBoxScore, d => +d['DJSolo']).toFixed(1) : '',
                            d3.max(contestantData, d => +d['DJDDF']).toFixed(0),
                            d3.max(contestantData, d => +d['DJDD+']).toFixed(2),
                            d3.max(contestantData, d => +d['DJDD1'] + +d['DJDD2']).toFixed(0),
                        ];
                    })
                    .enter()
                    .append("td")
                    .html(d => d)
                    .attr('class', function(d,i) {
                        if (i < 1) {
                            return '';
                        } else if (i < 16) {
                            return 'controlled cumulative';
                        } else if (i < 32) {
                            return 'controlled game-average';
                        } else if (i < 44) {
                            return 'controlled j-average';
                        } else if (i < 56) {
                            return 'controlled dj-average';
                        } else if (i < 72) {
                            return 'controlled game-maximum';
                        } else if (i < 84) {
                            return 'controlled j-maximum';
                        } else if (i < 96) {
                            return 'controlled dj-maximum';
                        } else {
                            return '';
                        }
                    });
                controlTable('table#contestant-summary-table', ['cumulative','game-average','j-average','dj-average','game-maximum','j-maximum','dj-maximum']);
                

                //Buzzes
                var attemptsTraceBuzC = {
                    x: d3.map(highlightContestantIds, c => d3.filter(data, cd => cd['Jometry Contestant Id'] === c)[0]['Contestant']),
                    y: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['BuzC']))),
                    text: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['BuzC'])).toFixed(1)),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        }
                    }
                };
                var attemptsTraceBuzI = {
                    x: d3.map(highlightContestantIds, c => d3.filter(data, cd => cd['Jometry Contestant Id'] === c)[0]['Contestant']),
                    y: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['BuzI']))),
                    text: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['BuzI'])).toFixed(1)),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.5
                    }
                };
                var attemptsData = [attemptsTraceBuzC, attemptsTraceBuzI];
                var attemptsLayout = {
                    barmode: 'stack',
                    showlegend: false,
                    yaxis: {
                        title: {
                            text: "Buzzes",
                            standoff: 20
                        }
                    }
                };
                Plotly.newPlot('bar-buzzes', attemptsData, attemptsLayout);

                var traceBuzScore = {
                    x: d3.map(highlightContestantIds, c => d3.filter(data, cd => cd['Jometry Contestant Id'] === c)[0]['Contestant']),
                    y: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['Buz$']))),
                    text: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['Buz$'])).toFixed(0)),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        }
                    }
                };
                var traceBuzIScore = {
                    x: d3.map(highlightContestantIds, c => d3.filter(data, cd => cd['Jometry Contestant Id'] === c)[0]['Contestant']),
                    y: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['JBuzI$'] + +cd1['DJBuzI$']))),
                    text: d3.map(highlightContestantIds, c => d3.mean(d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === c), cd1 => +cd1['JBuzI$'] + +cd1['DJBuzI$'])).toFixed(0)),
                    type: 'bar',
                    marker: {
                        color: d3.map(highlightContestantIds, color),
                        line: {
                            color: 'black',
                            width: 1
                        },
                        opacity: 0.5
                    }
                };
                var buzScoreData = [traceBuzScore, traceBuzIScore];
                var buzScoreLayout = {
                    barmode: 'stack',
                    showlegend: false,
                    yaxis: {
                        title: {
                            text: "Buz$",
                            standoff: 20
                        }
                    }
                };
                Plotly.newPlot('bar-buz$', buzScoreData, buzScoreLayout);


                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuzC'],
                    cd1 => +cd1['DJBuzC'],
                    'line-buzc-j-dj',
                    'BuzC difference',
                    cd => true,
                    'BuzC'
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuzInc'],
                    cd1 => +cd1['DJBuzInc'],
                    'line-buzi-j-dj',
                    'BuzI difference',
                    cd => true,
                    'BuzI'
                );


                //Histogram set
                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Buz'],
                    'box-buz',
                    'Buz',
                    cd1 => true
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuz'],
                    cd1 => +cd1['DJBuz'],
                    'line-buz-j-dj',
                    'Buz difference',
                    cd => true,
                    'Buz'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Att'],
                    'box-att',
                    'Att',
                    cd1 => cd1['Att'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JAtt'],
                    cd1 => +cd1['DJAtt'],
                    'line-att-j-dj',
                    'Att difference',
                    cd1 => cd1['Att'] !== "",
                    'Att'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Buz%'],
                    'box-buz%',
                    'Buz%',
                    cd1 => cd1['Att'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuz%'],
                    cd1 => +cd1['DJBuz%'],
                    'line-buz%-j-dj',
                    'Buz% difference',
                    cd1 => cd1['Att'] !== "",
                    'Buz%'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Buz$'],
                    'box-buz$',
                    'Buz$',
                    cd1 => true
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuz$'],
                    cd1 => +cd1['DJBuz$'] / 2.0,
                    'line-buz$-j-dj',
                    'Buz$ difference',
                    cd => true,
                    'Buz$ (J dollars)'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => 1.0 * +cd1['Buz$'] / +cd1['Buz'],
                    'box-buz$-per-buz',
                    'Buz$/Buz',
                    cd1 => true
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JBuz$'] / +cd1['JBuz'],
                    cd1 => +cd1['DJBuz$'] / 2.0 / +cd1['DJBuz'],
                    'line-buz$-per-buz-j-dj',
                    'Buz$/Buz difference',
                    cd => true,
                    'Buz$ (J dollars)'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Speed'],
                    'box-speed',
                    'Speed',
                    cd1 => cd1['Speed'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JSpeed'],
                    cd1 => +cd1['DJSpeed'],
                    'line-speed-j-dj',
                    'Speed difference',
                    cd1 => cd1['Speed'] !== "",
                    'Speed'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Solo'],
                    'box-solo',
                    'Solo',
                    cd1 => cd1['Solo'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JSolo'],
                    cd1 => +cd1['DJSolo'],
                    'line-solo-j-dj',
                    'Solo difference',
                    cd1 => cd1['Solo'] !== "",
                    'Solo'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['Speed'] + +cd1['Solo'],
                    'box-speed-plus-solo',
                    'Speed + Solo',
                    cd1 => cd1['Solo'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JSpeed'] + +cd1['JSolo'],
                    cd1 => +cd1['DJSpeed'] + +cd1['DJSolo'],
                    'line-speed-plus-solo-j-dj',
                    'Speed+Solo difference',
                    cd1 => cd1['Solo'] !== "",
                    'Speed + Solo'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['DD+'],
                    'box-dd+',
                    'DD+',
                    cd1 => cd1['DD+'] !== ""
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JDD+'],
                    cd1 => +cd1['DJDD+'],
                    'line-dd+-j-dj',
                    'DD+ difference',
                    cd => true,
                    'DD+'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JDD'] + +cd1['DJDD1'] + +cd1['DJDD2'],
                    'box-dd$',
                    'DD$',
                    cd1 => true
                );
                renderHighlightContestantRoundLinePlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['JDD'],
                    cd1 => (+cd1['DJDD1'] + +cd1['DJDD2']) / 2.0,
                    'line-dd$-j-dj',
                    'DD$ difference',
                    cd => true,
                    'DD$ (J dollars)'
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['DJFinal$'],
                    'box-djfinal$',
                    'DJFinal$',
                    cd1 => cd1['DJFinal$'] !== ""
                );

                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['FJ$'],
                    'box-fj$',
                    'FJ$',
                    cd1 => cd1['FJ$'] !== ""
                );
                
                renderHighlightContestantBoxPlot(
                    data,
                    highlightContestantIds,
                    cd1 => +cd1['FJFinal$'],
                    'box-fjfinal$',
                    'FJFinal$',
                    cd1 => cd1['FJFinal$'] !== ""
                );
                

                plotData = [];
                for ( var i = 0; i < highlightContestantIds.length; i ++ ) {
                    var cid = highlightContestantIds[i];
                    var trace = {
                        x: d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === cid), cd1 => +cd1['Buz']),
                        y: d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === cid), cd1 => +cd1['Buz$'] / +cd1['Buz']),
                        mode: 'markers',
                        type: 'scatter',
                        name: getContestantNameFromData(data, cid),
                        text: d3.map(d3.filter(data, cd => cd['Jometry Contestant Id'] === cid), cd1 => cd1['Contestant'] + ", " + dateFormat(cd1['Date'])),
                        marker: { size: 5 }
                    };
                    plotData.push(trace);
                }
                var trace = {
                    x: d3.map(d3.filter(data, cd => !highlightContestantIds.includes(cd['Jometry Contestant Id'])), cd1 => +cd1['Buz']),
                    y: d3.map(d3.filter(data, cd => !highlightContestantIds.includes(cd['Jometry Contestant Id'])), cd1 => +cd1['Buz$'] / +cd1['Buz']),
                    mode: 'markers',
                    type: 'scatter',
                    name: "Others",
                    text: d3.map(d3.filter(data, cd => !highlightContestantIds.includes(cd['Jometry Contestant Id'])), cd1 => cd1['Contestant'] + ", " + dateFormat(cd1['Date'])),
                    marker: { size: 2 }
                };
                plotData.push(trace);

                var layout = {
                    xaxis: {
                        range: [ 0, 50 ]
                    },
                    yaxis: {
                        range: [-500, 1200]
                    },
                    legend: {
                        y: 0.5,
                        yref: 'paper',
                        font: {
                        family: 'Arial, sans-serif',
                        size: 20,
                        color: 'grey',
                        }
                    },
                    xaxis: {
                        title: 'Buz'
                    },
                    yaxis: {
                        title: 'Buz$/Buz'
                    },
                    title:'Buz$/Buz vs Buz'
                };

                Plotly.newPlot('scatter-buz$-buz-vs-buz', plotData, layout);

                plotData = [];
                groupedData.forEach((value, key) => {
                    if (highlightContestantIds.includes(key)) {
                        var trace = {
                            x: [d3.mean(d3.map(value, cd1 => +cd1['Buz']))],
                            y: [d3.mean(d3.map(value, cd1 => +cd1['Buz$'] / +cd1['Buz']))],
                            mode: 'markers+text',
                            type: 'scatter',
                            text: getContestantNameFromData(data, key),
                            textposition: 'top center',
                            marker: { size: 2 * Math.sqrt(value.length) },
                            showlegend: false
                        };
                        plotData.push(trace);
                    }
                });
                

                var layout = {
                    xaxis: {
                        title: 'Buz'
                    },
                    yaxis: {
                        title: 'Buz$/Buz'
                    },
                    title:'Average Buz$/Buz vs Buz'
                };

                Plotly.newPlot('scatter-avg-buz$-buz-vs-buz', plotData, layout);

            });
        </script>
    </body>
</html>